<html>
	<head>
		<link rel="icon" href="img/fire.png" type="image/png" sizes="16x16">
		<title>MyAnimeSearch</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" type="text/css" href="external.css">
	</head>
	<body>
		<div id="wrapper">
			<!--Page Header-->
			<div id="header">
				<div class="row">
					<div class="col-xs-11">
						<img src="img/fire.png" alt="Logo" class="logo">
						<h1 id="header-title">MyAnimeSearch</h1>
					</div>
					<div class="col-xs-1">
						<h4 id="header-text">For Your Anime Needs</h4>
					</div>
				</div>
			</div>
			<div id="logout">
				<div class="row">
					<div class="col-xs-11"></div>
					<div class="col-xs-1">
						<div id="logout-button">
							<h5 id='clientName'>client@gmail.com</h5>
							<a href="#">
								<span class="glyphicon glyphicon-off"></span>
							</a>
						</div>
					</div>
				</div>
			</div>
			<div id="sidebar-wrapper">
				<ul class="sidebar-nav">
					<li class="sidebar-brand"><a href="#">Client Portal</a></li>
					<li><a href="client.html">Search</a></li>
					<li><a href="#">Favorites</a></li>
					<li><a href="#">Settings</a></li>
				</ul>
			</div>
			<!--Content-->
			<div id="page-content-wrapper">
				<div class="container-fluid">
					<div class="row">
						<div class="col-xs-12">
							<a href="#" id="menu-toggle">
								<span class="glyphicon glyphicon-menu-hamburger"></span>
							</a>
							<h2 id="page-title">Search</h2>
							<!--Search Bar-->
							<input type="text" id="myInput" onkeyup="searchAnime()" placeholder="Search for an anime... e.g. Naruto" title="Type in a title">
						</div>
					</div>
					<!--Bootstrap Cards-->
					<div id="cardContainer">
						<div id="cardWrapper"></div>
					</div>					
<!--					<div class="row" id="cardResults">
						<div class="col-xs-1"></div>
						<div class="col-xs-2">
							<div class="card" id="#">
								<img class="card-img-top" src="#" alt="Card image cap">
								<div class="card-body">
									<h5 class="card-title">N/A</h5>
									<input type='hidden' name='detailsId' id='detailsId' value='' />
									<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#animeDetails">More details</button>						
								</div>
							</div>
						</div>
						<div class="col-xs-2">
							<div class="card" id="#">
								<img class="card-img-top" src="#" alt="Card image cap">
								<div class="card-body">
									<h5 class="card-title">N/A</h5>
									<input type='hidden' name='detailsId' id='detailsId' value='' />
									<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#animeDetails">More details</button>
								</div>
							</div>
						</div>
						<div class="col-xs-2">
							<div class="card" id="#">
								<img class="card-img-top" src="#" alt="Card image cap">
								<div class="card-body">
									<h5 class="card-title">N/A</h5>
									<input type='hidden' name='detailsId' id='detailsId' value='' />
									<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#animeDetails">More details</button>
								</div>
							</div>
						</div>
						<div class="col-xs-2">
							<div class="card" id="#">
								<img class="card-img-top" src="#" alt="Card image cap">
								<div class="card-body">
									<h5 class="card-title">N/A</h5>
									<input type='hidden' name='detailsId' id='detailsId' value='' />
									<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#animeDetails">More details</button>
								</div>
							</div>
						</div>
						<div class="col-xs-2">
							<div class="card" id="#">
								<img class="card-img-top" src="#" alt="Card image cap">
								<div class="card-body">
									<h5 class="card-title">N/A</h5>
									<input type='hidden' name='detailsId' id='detailsId' value='' />
									<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#animeDetails">More details</button>
								</div>
							</div>
						</div>
						<div class="col-xs-1"></div>
					</div>
-->
					<!--Modal-->
					<div class="modal fade" id="animeDetails" role="dialog">
						<div class="modal-dialog">
							<!-- Modal Content-->
							<div class="modal-content">
								<!--Modal Header-->
								<div class="modal-header">
									<button type="button" id="modalClose" class="close" data-dismiss="modal">&times;</button>
									<h3 class="modal-title">Details</h3>
								</div>
								<div class="modal-body">
									<table class="table table-striped table-bordered table-hover" id="animeTable">
										<thead></thead>
										<tbody id='detailsTable'>
<!--
											<tr>
												<th>Title</th>
												<td>Death Note</td>
											</tr>
											<tr>
												<th>Type</th>
												<td>TV</td>
											</tr>
											<tr>
												<th>Status</th>
												<td>Finished</td>
											</tr>
											<tr>
												<th>Start Date</th>
												<td>2006-10-04</td>
											</tr>
											<tr>
												<th>End Date</th>
												<td>2007-01-06</td>
											</tr>
											<tr>
												<th>Episodes</th>
												<td>24</td>
											</tr>
											<tr>
												<th>Episode Duration(min)</th>
												<td>23</td>
											</tr>
											<tr>
												<th>Total Duration(min)</th>
												<td>286</td>
											</tr>
											<tr>
												<th>Rating</th>
												<td>R</td>
											</tr>
											<tr>
												<th>Rating Guide</th>
												<td>Violence, Profanity</td>
											</tr>
											<tr>
												<th>Recommendations</th>
												<td>1. Assasination Classroom<br>2. Code Geass<br>3. Jigoku Shoujo</td>
											</tr>
-->
										</tbody>
									</table>
									<!--Modal Footer-->
									<div class="modal-footer">
										<div class="row">
											<div class="col-xs-7"></div>
											<div class="col-xs-3">
												<div class="form-group">        
													<div class="col-sm-offset-0">
														<button type="submit" class="btn btn-primary">Add to Favorites</button>
													</div>
												</div>
											</div>
											<div class="col-xs-2">
												<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			//Sidebar pop-out
			$("#menu-toggle").click(function(e) {
				e.preventDefault();
				$("#wrapper").toggleClass("menuDisplayed");
			});

			let result;
			
			//Search function
			function searchAnime(){
				let input = $('#myInput').val();

				if (input.length !=0){
					$('#cardWrapper').show(); //Display cards when search
					url = 'https://web-api-304cem.herokuapp.com/searchAnime/' + input;
				}
				else if (input.length ==0){
					$('#cardWrapper').hide(); //Hide card when searchbox is empty
				}

				fetch(url)
				.then(resp => {
					return resp.json();
				})
				.then(jsonResp => {

					if (input.length!=0){
						result = jsonResp;
					} 
					
					let content = document.getElementById('cardWrapper');
					//Clear display area
					content.innerHTML = ''; 
					let info = '';
					
					for (let i = 1; i <= result.length; i += 1) {
						current = i%5;
						
						//Start new row after 5th card
						if(current==1){
							info += '<div class="row" id="cardResults">';
							info += '<div class="col-xs-1"></div>';
						}

						info += `<div class="col-xs-2">`;
						info += `<div class="card`+ current +`" id="`+ i +`">`;
						info += `<img class="card-img-top" src="#" alt="Card image cap">`;
						info += `<div class="card-body">`;
						info += `<h5 class="card-title">N/A</h5>`;
						info += `<input type='hidden' name='detailsId' id='detailsId' value='' />`;
						info += `<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#animeDetails" onClick="showDetails(`+ i +`)">More details</button>`;
						info += `</div>`;
						info += `</div>`;
						info += `</div>`;

						if(current==0){
							info += '<div class="col-xs-1"></div>>';
							info += '</div>';
						}

						content.innerHTML = info;
					}
					
					//Assign card image and title
					for (let i = 1; i <= result.length; i += 1) {
						const anime = result[i-1];
						$(`#${i} .card-title`).text(anime['title']);
						$(`#${i} .card-img-top`).attr('src',anime['pic_url']);	
					}
			})
			.catch(err => {
				console.error(err);
			});
		}

		//Show details modal
		function showDetails(current){
			const anime = result[current-1];
			
			let table = document.getElementById('detailsTable');

			//Clear display area
			table.innerHTML = '';
			let info = '';		

			info+= `<tr><th>Title</th><td>`+ anime['title'] +`</td></tr>`;
			info+= `<tr><th>Type</th><td>`+ anime['type'] +`</td></tr>`;
			info+= `<tr><th>Status</th><td>`+ anime['status'] +`</td></tr>`;
			info+= `<tr><th>Start Date</th><td>`+ anime['start_date'] +`</td></tr>`;
			info+= `<tr><th>End Date</th><td>`+ anime['end_date'] +`</td></tr>`;
			info+= `<tr><th>Episodes</th><td>`+ anime['episodes'] +`</td></tr>`;
			info+= `<tr><th>Episode Duration(min)</th><td>`+ anime['episode_duration'] +`</td></tr>`;
			info+= `<tr><th>Total Duration(min)</th><td>`+ anime['total_duration'] +`</td></tr>`;
			info+= `<tr><th>Rating</th><td>`+ anime['rated'] +`</td></tr>`;
			info+= `<tr><th>Rating Guide</th><td>`+ anime['rated_guide'] +`</td></tr>`;
			info+= `<tr><th>Recommendations</th><td>1. ` + anime['recommendations'] + `<br>2. `+ anime['recommendations1'] +`<br>3. `+ anime['recommendations2'] +`</td></tr>`;
		
			table.innerHTML = info;
		}
		</script>
	</body>
</html>

