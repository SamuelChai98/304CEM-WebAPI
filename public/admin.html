<html>
	<head>
		<link rel="icon" href="img/fire.png" type="image/png" sizes="16x16">
		<title>MyAnimeSearch</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" type="text/css" href="external.css">
	</head>
	<body>
		<div id="wrapper">
			<!--Page Header-->
			<div id="header">
				<div class="row">
					<div class="col-xs-11">
						<img src="img/fire.png" alt="Logo" class="logo">
						<h1 id="header-title">MyAnimeSearch</h1>
					</div>
					<div class="col-xs-1">
						<h4 id="header-text">For Your Anime Needs</h4>
					</div>
				</div>
			</div>
			<div id="logout">
				<div class="row">
					<div class="col-xs-11"></div>
					<div class="col-xs-1">
						<div id="logout-button">
							<h5 id='clientName'>admin@gmail.com</h5>
							<a href="#">
								<span class="glyphicon glyphicon-off"></span>
							</a>
						</div>
					</div>
				</div>
			</div>
			<div id="sidebar-wrapper">
				<ul class="sidebar-nav">
					<li class="sidebar-brand"><a href="#">Admin Portal</a></li>
					<li><a href="admin.html">Manage</a></li>
					<li><a href="#">Settings</a></li>
				</ul>
			</div>
			<!--Content-->
			<div id="page-content-wrapper">
				<div class="container-fluid">
					<div class="row">
						<div class="col-xs-12">
							<a href="#" id="menu-toggle">
								<span class="glyphicon glyphicon-menu-hamburger"></span>
							</a>
							<h2 id="page-title">Manage</h2>
							<!--Search Bar-->
							<input type="text" id="myInput" onkeyup="searchFunction()" placeholder="Search for an anime... e.g. Naruto" title="Type in a title">
						</div>
					</div>
					<div class="row">
						<div class="col-xs-2"></div>
						<div class="col-xs-8">
							<button type="button" class="btn btn-primary btn-md pull-right" data-toggle="modal" data-target="#addAnime" id="createBtn">+ Add New</button>
							<table class="table table-striped table-bordered table-hover" id="searchTable">
								<thead>
									<tr>
										<th style="padding-right: 290px;">Anime Title</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody id='listingsTable'>
							<!--	
									<tr>
										<td>Death Note</td>
										<td>
											<div class="dropdown">
												<button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu">
													<li><a href="#" data-toggle="modal" data-target="#editAnime">Edit</a></li>
													<li><a href="#" data-toggle="modal" data-target="#deleteAnime">Delete</a></li>
												</ul>
											</div>
										</td>
									</tr>
									<tr>
										<td>Code Geass</td>
										<td>
											<div class="dropdown">
												<button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu">
													<li><a href="#">Edit</a></li>
													<li><a href="#">Delete</a></li>
												</ul>
											</div>
										</td>
									</tr>
									<tr>
										<td>Mirai Nikki</td>
										<td>
											<div class="dropdown">
												<button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu">
													<li><a href="#">Edit</a></li>
													<li><a href="#">Delete</a></li>
												</ul>
											</div>
										</td>
									</tr>
-->								</tbody>
							</table>
						</div>
						<div class="col-xs-2"></div>
					</div>

					<!--Add Modal-->
					<div class="modal fade" id="addAnime" role="dialog">
						<div class="modal-dialog">
							<!-- Modal Content-->
							<div class="modal-content">
								<!--Modal Header-->
								<div class="modal-header">
									<button type="button" id="addModalClose" class="close" data-dismiss="modal">&times;</button>
									<h3 class="modal-title">Add Anime</h3>
								</div>
								<div class="modal-body">
									<!--Add Anime Form-->
									<form class="form-horizontal" id="addAnimeForm" action="#">
										<div class="form-group">
											<label class="control-label col-sm-3" for="addAni">Anime Title:</label>
											<div class="col-sm-8">
												<input type="text" class="form-control" id="addAni" placeholder="Enter anime title" name="addAni" required>
											</div>
										</div>
										<!--Modal Footer-->
										<div class="modal-footer" style="margin-bottom: -45px;">
											<div class="row">
												<div class="col-xs-8"></div>
												<div class="col-xs-2">
													<div class="form-group">
														<div class="col-sm-offset-4 col-sm-8">
															<button type="button" name="submitted" onclick="addAnime()" class="btn btn-primary">Add</button>
														</div>
													</div>
												</div>
												<div class="col-xs-2">
													<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>

					<!--Edit Modal-->
					<div class="modal fade" id="editAnime" role="dialog">
						<div class="modal-dialog">
							<!-- Modal Content-->
							<div class="modal-content">
								<!--Modal Header-->
								<div class="modal-header">
									<button type="button" id="editModalClose" class="close" data-dismiss="modal">&times;</button>
									<h3 class="modal-title">Edit Anime</h3>
								</div>
								<div class="modal-body">
									<!--Edit Anime Form-->
									<form class="form-horizontal" id="editAnimeForm" action="#">
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniTitle">Title:</label>
											<div class="col-sm-8">
												<input type="text" class="form-control" id="aniTitle" placeholder="Enter anime title" name="aniTitle">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniType">Type:</label>
											<div class="col-sm-8">
												<input type="text" class="form-control" id="aniType" placeholder="Enter anime type" name="aniType">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniStatus">Status:</label>
											<div class="col-sm-8">
												<input type="text" class="form-control" id="aniStatus" placeholder="Enter anime status" name="aniStatus">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniStart">Start Date:</label>
											<div class="col-sm-8">
												<input type="date" class="form-control" id="aniStart" placeholder="Enter anime start date" name="aniStart">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniEnd">End Date:</label>
											<div class="col-sm-8">
												<input type="date" class="form-control" id="aniEnd" placeholder="Enter anime end date" name="aniEnd">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniEp">Episodes:</label>
											<div class="col-sm-8">
												<input type="number" class="form-control" id="aniEp" placeholder="Enter anime episodes" name="aniEp">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniEpLen">Ep dur(min):</label>
											<div class="col-sm-8">
												<input type="number" class="form-control" id="aniEpLen" placeholder="Enter anime episode duration" name="aniEpLen">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniTotalLen">Total dur(min):</label>
											<div class="col-sm-8">
												<input type="number" class="form-control" id="aniTotalLen" placeholder="Enter anime total duration" name="aniTotalLen">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniRate">Rating:</label>
											<div class="col-sm-8">
												<input type="text" class="form-control" id="aniRate" placeholder="Enter anime rating" name="aniRate">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniRateGuide">Rating Guide:</label>
											<div class="col-sm-8">
												<input type="text" class="form-control" id="aniRateGuide" placeholder="Enter anime rating guide" name="aniRateGuide">
											</div>
										</div>
										<div class="form-group">
											<label class="control-label col-sm-3" for="aniRec">Rec:</label>
											<div class="col-sm-8">
												<input type="text" class="form-control" id="aniRec" placeholder="Enter anime recommendations" name="aniRec">
											</div>
										</div>
										<!--Modal Footer-->
										<div class="modal-footer" style="margin-bottom: -45px;">
											<div class="row">
												<div class="col-xs-8"></div>
												<div class="col-xs-2">
													<div class="form-group">						
														<div class="col-sm-offset-4 col-sm-8">
															<button type="button" name="submitted" onclick="editAnime()" class="btn btn-primary">Edit</button>
														</div>
													</div>
												</div>
												<div class="col-xs-2">
													<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
										
					<!--Delete Modal-->
					<div class="modal fade" id="deleteAnime" role="dialog">
						<div class="modal-dialog">
							<!-- Modal Content-->
							<div class="modal-content">
								<!--Modal Header-->
								<div class="modal-header">
									<button type="button" id="delModalClose" class="close" data-dismiss="modal">&times;</button>
									<h3 class="modal-title">Delete Anime</h3>
								</div>
								<div class="modal-body">
									<!--Delete Anime Confirmation-->
									<p>Are you sure you want to delete this anime?</p>
									<div class="modal-footer" style="margin-bottom: -20px;">
										<div class="row">
											<div class="col-xs-8"></div>
											<div class="col-xs-2">
												<div class="form-group">
													<div class="col-sm-offset-7 col-sm-10">
														<button type="button" name="submitted" onclick="deleteAnime()" class="btn btn-primary">Yes</button>
													</div>
												</div>
											</div>
											<div class="col-xs-2">
												<button type="button" class="btn btn-default" data-dismiss="modal">No</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			//Sidebar pop-out
			$("#menu-toggle").click(function(e) {
				e.preventDefault();
				$("#wrapper").toggleClass("menuDisplayed");
			});

			//Search bar function
			function searchFunction(){
				var input, filter, table, tr, td, i;
				input = document.getElementById("myInput");
				filter = input.value.toUpperCase();
				table = document.getElementById("searchTable");
				tr = table.getElementsByTagName("tr");
				for (i = 0; i < tr.length; i++) {
					td = tr[i].getElementsByTagName("td")[0]; //Search in first column
					if (td) {
						if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
							tr[i].style.display = "";
						} else {
							tr[i].style.display = "none";
						}
					}
				}
			}

			jQuery(document).ready(() => {
				displayAnimeList();
			});

			//Display all animes in table
			function displayAnimeList(){
				url = 'https://web-api-304cem.herokuapp.com/getAllAnimes/'
				fetch(url)
				.then(resp => {
					return resp.json();
				})
				.then(jsonResp => {
					result = jsonResp;
					
					let table = document.getElementById('listingsTable');
					//Clear display area
					table.innerHTML = ''; 
					let info = '';

					for (let i = 1; i <= result.length; i += 1) {
						const anime = result[i-1];

						info+= `<tr><td>`+ anime['title'] +`</td>`;
						info+= `<td><div class="dropdown">`;
						info+= `<button class="btn dropdown-toggle" type="button" data-toggle="dropdown">`;
						info+= `<span class="caret"></span>`;
						info+= `</button><ul class="dropdown-menu">`;
						info+= `<li><a href="#" data-toggle="modal" data-target="#editAnime">Edit</a></li>`;
						info+= `<li><a href="#" data-toggle="modal" data-target="#deleteAnime" onclick="getDeleteId(event)" id="`+ anime['_id'] +`">Delete</a></li>`;
						info+= `</ul></div></td></tr>`;

					table.innerHTML = info;
					}
				});
			}

			//Add Anime function
			function addAnime(){
				let input = $('#addAni').val();
				url = 'https://web-api-304cem.herokuapp.com/addAnime/' + input;
				
				fetch(url)
				.then(resp => {
					return resp;
				})
				.then(jsonResp => {
					result = jsonResp;
				
					if(result['status'] === 200){
						jQuery('#addModalClose').click();
						displayAnimeList();
					}
					else{
						alert("Please try again.");
					}		
					$('#addAni').clear(); //Clear Add Anime textbox
				});
			}

			var selection;

			function getDeleteId(event){
				var x = event.target;
				selection = x.id;
			}

			//Delete Anime function
			function deleteAnime(){
				url = 'https://web-api-304cem.herokuapp.com/deleteAnime/' + selection;

				fetch(url)
				.then(resp => {
					return resp;
				})
				.then(jsonResp => {
					result = jsonResp;

					if(result['status'] === 200){
						jQuery('#delModalClose').click();
						displayAnimeList();
					}
					else{
						alert("Please try again.");
					}					
				});
			}
		</script>
	</body>
</html>